/*! jtTreeJs 0.8.0 2014-07-29 */
var JusTo=JusTo||{};JusTo.ui=JusTo.ui||{},JusTo.ui.Node=function(a,b,c){this.parent=null,this.children=[],this.childDom=null,this.value=a||"",this.id=b,this.selected=!1,this.visible=!0,this.childrenVisible=void 0===c,this.urlSubItems=c,this.options={},this.innerDoms={},this.outterDom=this._newListItem(this),this.events.init()},JusTo.ui.Node.prototype.events=function(){return{initialized:!1,init:function(){this.initialized||(JusTo.ui.Node.canSelect=JusTo.ui.NodeFilter.any,this.initOpenState(),this.initNodeTypeChanged(),this.initContentClicked(),this.initialized=!0)},initOpenState:function(){this.openStateChanged.push(function(a){var b=a.innerDoms.icon;b.className="icon",b.className+=a.childrenVisible?" folder-opened":" folder-closed"})},initNodeTypeChanged:function(){this.nodeTypeChanged.push(function(a){var b=a.innerDoms.icon;b.className="icon",b.className+=a.childrenVisible?" folder-opened":" folder-closed"})},initContentClicked:function(){this.contentClicked.push(function(a,b){b.setSelected(!b.selected)})},openStateChanged:[],nodeTypeChanged:[],selectionChanged:[],contentClicked:[],asyncOpened:[]}}(),JusTo.ui.Node.prototype.setTitle=function(a){this.innerDoms.listItem.setAttribute("title",a)},JusTo.ui.Node.prototype.find=function(a){{var b=null;this.iterate(function(c){return c.id===a?(b=c,!1):!0})}return b},JusTo.ui.Node.prototype.findRoot=function(){if(this.isRoot())return this;for(var a=this.parent;!a.isRoot();)a=a.parent;return a},JusTo.ui.Node.prototype.isRoot=function(){return this.id<0},JusTo.ui.Node.prototype.setSelected=function(a,b){if(b||JusTo.ui.Node.canSelect(this)){var c=this.innerDoms.content;this.selected=a,c.className="content",c.className+=this.selected?" selected":"",this._nodeSelectionChanged(this)}},JusTo.ui.Node.prototype._setChildrenVisible=function(a){this.children.forEach(function(b){b.outterDom.style.display=a?"":"none",b.visible=a}),this.childrenVisible=a},JusTo.ui.Node.prototype.isOpened=function(){return this.childrenVisible},JusTo.ui.Node.prototype.hasChildren=function(){return this.children.length>0},JusTo.ui.Node.prototype.isLeaf=function(){return!this.hasChildren()&&void 0===this.urlSubItems},JusTo.ui.Node.prototype.push=function(a){a.parent=this,this._insertNode(a),this.children.push(a)},JusTo.ui.Node.prototype.createAndpush=function(a,b,c){var d=new JusTo.ui.Node(a,b,c);return this.push(d),d},JusTo.ui.Node.prototype._insertNode=function(a){var b=this.outterDom;this.isRoot()||(this.hasChildren()||(this.childDom=document.createElement("ul"),b.appendChild(this.childDom),this._setChildrenVisible(!0),this._nodeTypeChanged(this)),b=this.childDom,this.outterDom.firstChild.className="expander expanded",this.outterDom.firstChild.style.display=""),b.appendChild(a.outterDom)},JusTo.ui.Node.prototype._newListItem=function(a){if(this.isRoot()){var b=document.createElement("ul");return b.className="justo-root-list",b}var c=document.createElement("li"),d=this._createExpanderElement(a),e=this._createIconElement(a),f=this._createContentElement(a);return c.appendChild(d),c.appendChild(e),c.appendChild(f),this.innerDoms.listItem=c,this.innerDoms.expander=d,this.innerDoms.icon=e,this.innerDoms.content=f,c},JusTo.ui.Node.prototype._createExpanderElement=function(){var a=document.createElement("span"),b=this;return a.className="expander",a.style.display="none",void 0!==this.urlSubItems&&(a.className+=" collapsed",a.style.display=""),a.addEventListener("click",function(){b.isOpened()?b.close():b.open()}),a},JusTo.ui.Node.prototype._createIconElement=function(a){var b=document.createElement("span");return b.className="icon document",void 0!==a.urlSubItems&&(b.className="icon folder-closed"),b},JusTo.ui.Node.prototype.open=function(){switch(arguments.length){case 0:return this._open();case 1:return"number"==typeof arguments[0]?this._openId(arguments[0]):this._openPath(Array.prototype.slice.call(arguments[0]))}return this._openPath(Array.prototype.slice.call(arguments))},JusTo.ui.Node.prototype._open=function(){return void 0!==this.urlSubItems&&this.loaded!==!0?this._asyncOpen():(this.innerDoms.expander.className="expander expanded",this._setChildrenVisible(!0),this._nodeOpenChanged(this)),this},JusTo.ui.Node.prototype._openId=function(a){var b=this.find(a);return null!==b?(b.open(),b):null},JusTo.ui.Node.prototype._openPath=function(a){var b=-1,c=function(c){if(c.isOpened()){b++;var e=a[b],f=c.find(e);b===a.length-1?(f.isLeaf()?f.setSelected(!0):f.open(),b=-1,f.innerDoms.content.scrollIntoView(!0),c.events.openStateChanged.splice(d,1)):null!==f&&f.open()}},d=this.events.openStateChanged.push(c)-1,e=a.shift();this._openId(e)},JusTo.ui.Node.prototype.close=function(){this.innerDoms.expander.className="expander collapsed",this._setChildrenVisible(!1),this._nodeOpenChanged(this)},JusTo.ui.Node.prototype._asyncOpen=function(){var a=new XMLHttpRequest,b=this,c=this.innerDoms.icon;c.className="icon loading",a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var c=JSON.parse(a.responseText).result;c.forEach(function(a){var c=new JusTo.ui.Node(a.value,a.id,a.urlSubItems);c.setTitle(a.title),b.push(c)}),b.loaded=!0,b._setChildrenVisible(!0),b._nodeOpenChanged(b),b._nodeAsyncOpened(b)}},a.open("GET",this.urlSubItems,!0),a.send()},JusTo.ui.Node.prototype._createContentElement=function(a){var b=document.createElement("span"),c=this;return b.innerHTML=a.value,b.className="content",b.addEventListener("click",function(b){c._contentClicked(b,a),b.stopPropagation()}),b},JusTo.ui.Node.prototype.selectAll=function(a){void 0===a&&(a=!0),this.iterate(function(b){b.selected!=a&&b.setSelected(a,!0)})},JusTo.ui.Node.prototype.iterate=function(a,b){this._iterate(a,b,0)},JusTo.ui.Node.prototype._iterate=function(a,b,c){++c;var d=!0;this.children.forEach(function(e){(!b||b(e))&&a(e,c)===!1&&(d=!1),d&&e._iterate(a,b,c)})},JusTo.ui.Node.prototype._nodeOpenChanged=function(a){this.events.openStateChanged.forEach(function(b){b(a)})},JusTo.ui.Node.prototype._nodeTypeChanged=function(a){this.events.nodeTypeChanged.forEach(function(b){b(a)})},JusTo.ui.Node.prototype._contentClicked=function(a,b){this.events.contentClicked.forEach(function(c){c(a,b)})},JusTo.ui.Node.prototype._nodeSelectionChanged=function(a){this.events.selectionChanged.forEach(function(b){b(a)})},JusTo.ui.Node.prototype._nodeAsyncOpened=function(a){this.events.asyncOpened.forEach(function(b){b(a)})};var JusTo=JusTo||{};JusTo.ui=JusTo.ui||{},JusTo.ui.NodeFilter=function(){return{selected:function(a){return a.selected},unselected:function(a){return!a.selected},leaf:function(a){return a.isLeaf()},leafSingle:function(a){var b=void 0===a.urlSubItems&&!a.hasChildren();return b&&a.findRoot().selectAll(!1),b},single:function(a){return a.findRoot().selectAll(!1),!0},any:function(){return!0},all:function(){return this.any},children:function(a){var b=a.selected;return a.selectAll(!b),!0}}}();